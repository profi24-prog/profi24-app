<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PROFI24</title>
  <style>
    body { background:#121212; color:#eee; font-family:Arial,sans-serif; margin:0; padding:0; }
    header { padding:1em; background:#1d1d1d; }
    h1 { margin:0; font-size:24px; }
    nav a { color:#eee; margin-right:1em; text-decoration:none; }
    section { padding:1em; }
    .container { max-width:800px; margin:auto; }
    input, select, textarea, button { display:block; width:100%; margin:0.5em 0; padding:0.5em; background:#222; color:#eee; border:1px solid #444; border-radius:4px; }
    button { background:#007bff; border:none; color:#fff; cursor:pointer; }
    button:disabled { background:#555; }
    table { width:100%; border-collapse:collapse; margin-top:1em; }
    th, td { border:1px solid #444; padding:0.5em; text-align:left; }
    .card { background:#1e1e1e; padding:1em; margin-bottom:1em; border-radius:4px; }
  </style>
</head>
<body>
<header>
  <div class="container">
    <h1>PROFI24</h1>
    <nav>
      <a href="#home" onclick="showSection('home')">Home</a>
      <a href="#orders" onclick="showSection('orders')">Orders</a>
      <a href="#crm" onclick="showSection('crm')">CRM</a>
    </nav>
  </div>
</header>
<main>
  <div class="container">
    <section id="homeSection">
      <h2>Welcome to PROFI24</h2>
      <p>Status: <span id="status">Checking...</span></p>
      <h3>Order a Service</h3>
      <form id="orderForm">
        <select id="serviceSelect"></select>
        <input id="contactInput" placeholder="Your contact (phone/email)" required />
        <textarea id="descriptionInput" placeholder="Describe your problem"></textarea>
        <button type="submit">Create Order</button>
      </form>
    </section>
    <section id="ordersSection" style="display:none">
      <h2>Your Orders</h2>
      <div id="ordersList"></div>
    </section>
    <section id="crmSection" style="display:none">
      <h2>CRM</h2>
      <h3>Add Contact</h3>
      <form id="contactForm">
        <input id="contactName" placeholder="Name" required />
        <input id="contactPhone" placeholder="Phone" />
        <input id="contactEmail" placeholder="Email" />
        <button type="submit">Add Contact</button>
      </form>
      <h3>Contacts</h3>
      <div id="contactsList"></div>
      <h3>Add Task</h3>
      <form id="taskForm">
        <input id="taskTitle" placeholder="Task title" required />
        <input id="taskDue" type="date" />
        <button type="submit">Add Task</button>
      </form>
      <h3>Tasks</h3>
      <div id="tasksList"></div>
    </section>
  </div>
</main>
<script>
function showSection(name){
  document.getElementById('homeSection').style.display = name==='home'?'block':'none';
  document.getElementById('ordersSection').style.display = name==='orders'?'block':'none';
  document.getElementById('crmSection').style.display = name==='crm'?'block':'none';
  if(name === 'orders') loadOrders();
  if(name === 'crm') { loadContacts(); loadTasks(); }
}
async function fetchAPI(path, options={}) {
  const res = await fetch(path, {headers:{'Content-Type':'application/json'}, ...options});
  return res.json();
}
async function init(){
  fetchAPI('/api/hello').then(data=>{document.getElementById('status').textContent = data.message;});
  const services = await fetchAPI('/api/services');
  const select = document.getElementById('serviceSelect');
  services.forEach(s=>{
    const option = document.createElement('option');
    option.value = s.id;
    option.textContent = s.title;
    select.appendChild(option);
  });
}
document.getElementById('orderForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const serviceId = document.getElementById('serviceSelect').value;
  const contact = document.getElementById('contactInput').value;
  const description = document.getElementById('descriptionInput').value;
  await fetchAPI('/api/orders',{method:'POST',body:JSON.stringify({serviceId,contact,description})});
  alert('Order created');
});
async function loadOrders(){
  const orders = await fetchAPI('/api/orders');
  const container = document.getElementById('ordersList');
  container.innerHTML = '';
  orders.forEach(o=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = '<strong>'+o.id+'</strong><br>Service: '+o.serviceId+'<br>Status: '+o.status+'<br>Contact: '+o.contact+'<br><button onclick="acceptOrder(\\''+o.id+'\\')">Accept</button> <button onclick="completeOrder(\\''+o.id+'\\')">Complete</button>';
    container.appendChild(card);
  });
}
async function acceptOrder(id){ await fetchAPI('/api/orders/'+id+'/accept',{method:'POST'}); loadOrders(); }
async function completeOrder(id){ await fetchAPI('/api/orders/'+id+'/complete',{method:'POST'}); loadOrders(); }
document.getElementById('contactForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const name=document.getElementById('contactName').value;
  const phone=document.getElementById('contactPhone').value;
  const email=document.getElementById('contactEmail').value;
  await fetchAPI('/api/crm/contacts',{method:'POST',body:JSON.stringify({name,phone,email})});
  loadContacts();
});
async function loadContacts(){
  const contacts = await fetchAPI('/api/crm/contacts');
  const container=document.getElementById('contactsList');
  container.innerHTML='';
  contacts.forEach(c=>{
    const div=document.createElement('div');
    div.className='card';
    div.textContent=c.name+' ('+c.phone+')';
    container.appendChild(div);
  });
}
document.getElementById('taskForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const title=document.getElementById('taskTitle').value;
  const dueAt=document.getElementById('taskDue').value;
  await fetchAPI('/api/crm/tasks',{method:'POST',body:JSON.stringify({title,dueAt})});
  loadTasks();
});
async function loadTasks(){
  const tasks = await fetchAPI('/api/crm/tasks');
  const container=document.getElementById('tasksList');
  container.innerHTML='';
  tasks.forEach(t=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=t.title+' - '+t.status+' <button onclick="closeTask(\\''+t.id+'\\')">Close</button>';
    container.appendChild(div);
  });
}
async function closeTask(id){ await fetchAPI('/api/crm/tasks/'+id+'/close',{method:'POST'}); loadTasks(); }
init();
</script>
</body>
</html>
